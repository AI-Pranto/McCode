<!DOCTYPE html>
<head>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="d3.v4.min.js"></script>
</head>
<body>
<script>
function plot_wrap(w, h, x, y, yerr) {
  var margin = 5;
  var wlab = w - 2*margin;
  var hlab = h - 2*margin;

  // axis labels

  var lblGroup = d3.select("body").append("svg")
    .attr("width", w)
    .attr("height", h)
    .append("g")
    .attr("transform", "translate(" + margin +"," + margin + ")");

  var title = lblGroup
    .append("text")
    //.attr("x", titx)
    //.attr("y", tity)
    .text("title")
    //.attr("dominant-baseline", "hanging")
    .attr("text-anchor", "middle");

  var xLabel = lblGroup
    .append("text")
    //.attr("x", xlabx)
    //.attr("y", xlaby)
    .text("xlabel")
    .attr("dominant-baseline", "middle")
    .attr("text-anchor", "middle");

  var yLabel = lblGroup
    .append("text")
    .attr("x", ylabx)
    .attr("y", ylaby)
    .text("ylabel")
    //.attr("transform", "rotate(-90," + ylabx + ',' + ylaby + ")")
    //.attr("dominant-baseline", "middle")
    .attr("text-anchor", "middle");

  var dt = title.node().getBBox().height;
  var dl = yLabel.node().getBBox().height; // height and width are confused here, due to the rotation
  var db = xLabel.node().getBBox().height;

  var wplt = wlab - 3*dl;
  var hplt = hlab - (1.3*dt + 2*db);
  var xplt = 3*dl;
  var yplt = 1.3*dt;

  var titx = wlab/2;
  var tity = dt/2;
  var xlabx = wplt/2 + xplt;
  var xlaby = hlab - db/2;
  var ylabx = dl/2;
  var ylaby = yplt + hplt/2;

  // position labels based on what was drawn
  title.attr("transform", "translate(" + titx + "," + tity + ")");
  xLabel.attr("transform", "translate(" + xlabx + "," + xlaby + ")");
  yLabel.attr("transform", "rotate(-90," + ylabx + ',' + ylaby + ")  translate(" + ylabx + "," + ylaby + ")");

  var axisGroup = lblGroup
    .append("g")
    .attr("transform", "translate(" + xplt +"," + yplt + ")");

  plot(wplt, hplt, x, y, yerr, axisGroup);
}

function plot(w, h, x, y, yerr, anchorElement) {
  // axis size fractions and orego placement fraction
  var xax_frac = 1;
  var yax_frac = 1;
  var x0_frac = 0;
  var y0_frac = 0;

  // axes lengths
  var wi = xax_frac*w;
  var hi = yax_frac*h;
  // orego
  var x0 = x0_frac*w;
  var y0 = h - y0_frac*h;
  // axes end coords
  var x1 = x0 + wi;
  var y1 = y0 - hi;

  var dataPoints = []
  for (var i=0; i < x.length; i++) {
    dataPoints.push({"x" : x[i], "y" : y[i]});
  }

  // set up axes
  var svgContainer = anchorElement;

  var xScale = d3.scaleLinear()
    .domain([d3.min(x), d3.max(x)])
    .range([x0, x1]);
  var xAxis = d3.axisBottom()
    .ticks(5)
    .scale(xScale);
  var xAxisGroup = svgContainer.append("g")
    .attr("transform", "translate(0," + y0 + ")")
    .call(xAxis);

  var yScale = d3.scaleLinear()
    .domain([d3.min(y), d3.max(y)])
    .range([y0, y1]);
  var yAxis = d3.axisLeft()
    .ticks(5)
    .scale(yScale);
  var yAxisGroup = svgContainer.append("g")
    .attr("transform", "translate(" + x0 + ", 0)")
    .call(yAxis);

  // enter data points
  var pointGroup = svgContainer.append("g")

  var points = pointGroup.selectAll("circle")
    .data(dataPoints)
    .enter()
    .append("circle")
    .attr("cx", function(d) { return xScale(d["x"]) })
    .attr("cy", function(d) { return yScale(d["y"]) })
    .attr("r", 1);
}
  var x = @X_DATA_ARRAY@;
  var y = @Y_DATA_ARRAY@;
  var yerr = @YERR_DATA_ARRAY@;
  var w = @WIDTH@;
  var h = @HEIGHT@;
  plot_wrap(w, h, x, y, yerr);
</script>
</body>
</html>
