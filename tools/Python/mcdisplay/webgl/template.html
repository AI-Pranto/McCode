<!DOCTYPE html>
<html>
<head>
	<meta charset=utf-8>
	<style>
		body { margin: 0; }
		canvas { width: 100%; height: 100% }
	</style>
</head>
<body>
	<script src="https://sim.e-neutrons.org/static/threejs/three.min.js"></script>
	<script src="https://sim.e-neutrons.org/static/threejs/dat.gui.min.js"></script>
	<script src="https://sim.e-neutrons.org/static/threejs/OrbitControls.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
	<script src="_mcdisplay.js"></script>
	<script src="_instr.js"></script>
	<script src="_neutrons.js"></script>

	<script>
		var x = -26.3, y = 26.3, z = 26.3;
		// INSERT_CAMPOS_HERE: x = XVAL, y = YVAL, z = ZVAL;
		var controller = new Controller(x, y, z);
		var viewmodel = controller.viewmodel;

		// UI event handlers interacting only(!!) with the viewmodel.
		// TODO: implement callbacks
		var handlePlayPause = function()
		{
			if (viewmodel.playBack == PlayBack.RUN)
			{
				viewmodel.setPlayBack(PlayBack.PAUSE);
			}
			else
			{
				viewmodel.setPlayBack(PlayBack.RUN);
			}
		}
		var handleNext = function()
		{
			viewmodel.playBack = PlayBack.PAUSE;
			viewmodel.setRayIdx(viewmodel.getRayIdx() + 1);
		}
		var handlePrev = function()
		{
			viewmodel.playBack = PlayBack.PAUSE;
			viewmodel.setRayIdx(viewmodel.getRayIdx() - 1);
		}
	</script>

	<div id="gui" style="width: auto; background-color: black;">
		<label id="lblInstrInfo" style="color: white;">(instr)</label>
	</div>
	<div id="gui" style="width: auto; background-color: black;">
		<button id="btnPrev", onclick="handlePrev();" style="width: 90px;">Previous</button>
		<button id="btnPlayPause", onclick="handlePlayPause();" style="width: 90px;">Play/Pause</button>
		<button id="btnNext", onclick="handleNext();" style="width: 90px;">Next</button>
		<label id="lblRayIdxText" style="color: white;">Ray index: </label>
		<label id="lblRayIdx" style="color: white; background-color: black; width: 27px; text-align: right; display: inline-block;">(idx)</label>
		<label id="lblMaxRayIdx" style="color: white; background-color: black; display: inline-block;">(max_idx)</label>
	</div>
	<div id="3dcanvas"></div>

	<script>
		// gui synchronization class
		//
		var UpdateGui = function()
		{
			this.vm_version = -1;
			this.viewmodel = viewmodel;
		}
		UpdateGui.prototype.update = function()
		{
			if (this.vm_version == this.viewmodel.getUpdateVersion())
			{
				return;
			}
			this.vm_version = this.viewmodel.getUpdateVersion();

			var pb = this.viewmodel.getPlayBack();

			if (pb == PlayBack.RUN)
			{
				btn = document.getElementById("btnPlayPause");
				btn.innerHTML = "Pause";
			}
			if (pb == PlayBack.PAUSE)
			{
				btn = document.getElementById("btnPlayPause");
				btn.innerHTML = "Play";
			}
			lbl = document.getElementById("lblRayIdx");
			lbl.innerHTML = this.viewmodel.getRayIdx();
		}
		var upd = new UpdateGui();

		// set up static ui
		lblInstrInfo = document.getElementById("lblInstrInfo");
		lblInstrInfo.innerHTML = MCDATA_instrdata["cmd"];
		lblMaxRayIdx = document.getElementById("lblMaxRayIdx");
		lblMaxRayIdx.innerHTML = '/ ' + (MCDATA_neutrondata["numrays"] - 1);

		// call the mcdisplay app!
		controller.setUpdateGuiFunc(upd.update);
		controller.run();
    </script>
</body>
</html>
